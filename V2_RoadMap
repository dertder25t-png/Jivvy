# ðŸ—ºï¸ JIVVY Refactor Master Plan: "The Calm OS"

**Objective:** Transition Jivvy from a "Neo-Brutalist" app to a "Calm, Local-First Workspace" modeled after Todoistâ€™s structural efficiency and Notion's block logic.
**Core Philosophy:** "Tool First. AI Second."
**North Star:** Jivvy enforces clarity, constraints, and speed. It passes the "Boring Test."

---

## ðŸ—ï¸ Phase 1: Cleanup & Foundation
*Goal: Remove cognitive load. The UI should be invisible until needed.*

### 1.1 "De-Brutalization" (UI Purge)
- [ ] **Remove Neo-Brutalist Components:** Delete `GummyButton.tsx`, `TiltCard.tsx`, and `TrendChart.tsx`.
- [ ] **Reset Tailwind Config:** - [ ] Remove `lime-400` and other neon accents.
  - [ ] Remove heavy `border-4` and hard `box-shadow` utilities.
  - [ ] Define new palette: **Studio Slate** (Zinc-900/Zinc-50) and **Focus Blue** (Blue-600).
- [ ] **Install Shadcn/UI:** Add primitives (Button, Dialog, Dropdown, Avatar) with minimal radii.

### 1.2 The "Todoist" Shell (make the ui resembal and function like todoist not a direct clone but similir) 
- [ ] **Create `AppShell.tsx`:** Implement the persistent 3-column layout (Sidebar, Main, Context).
- [ ] **Build Sidebar (Left):**
  - [ ] User Profile/Settings (Top).
  - [ ] Quick Links: Inbox, Resume (Home), Calendar.
  - [ ] Project Tree (fetched from Dexie).
  - [ ] Trash/Archive (Bottom).
- [ ] **Build Main Stage (Center):** - [ ] Dynamic container for Editor/Canvas.
  - [ ] Add **Quick Add FAB** (bottom-right).
- [ ] **Build Context Panel (Right):** - [ ] Create a sliding panel component (hidden by default).

---

## ðŸ§± Phase 2: The Core "Block" Engine
*Architecture: "Block + View". We do not add new engines; we add new block types.*

### 2.1 Database & Schema
- [ ] **Update Dexie Schema (`lib/db.ts`):**
  - [ ] Implement `Block` table: `{ id, parent_id, content, type, metadata, order }`.
  - [ ] Implement `Project` table (folder hierarchy).
- [ ] **Refactor Store (`lib/store.ts`):** Support Block-based state management.

### 2.2 The Block Editor
- [ ] **Create `BlockEditor.tsx`:** replace `PageWorkspace.tsx`.
- [ ] **Implement Block Types:**
  - [ ] `Text` (Markdown).
  - [ ] `Task` (Checkbox, syncs with Resume).
  - [ ] `PDFHighlight` (Citation link).
  - [ ] `Image`.
- [ ] **Implement Interactions:**
  - [ ] **Slash Command (`/`):** Menu to change block type or call AI.
  - [ ] **Drag & Drop:** Vertical reordering of blocks.
  - [ ] **Indentation:** Tab/Shift+Tab logic for hierarchy.

---

## ðŸ“„ Phase 3: Resource Integration (Context)
*Principle: Progressive Disclosure. Tools only appear when needed.*

### 3.1 PDF Migration
- [ ] **Migrate PDF Viewer:** Move logic from main workspace to `components/pdf/PDFContextPanel.tsx`.
- [ ] **Refactor `ExtractionWorkspace`:** Deprecate the old workspace; enable the Context Panel logic.

### 3.2 Citation Logic
- [ ] **Implement Drag-to-Extract:**
  - [ ] Select text in PDF Side Panel -> Drag to Editor -> Create `PDFHighlight` block.
- [ ] **Implement Back-Linking:**
  - [ ] Clicking a `PDFHighlight` block in the Editor opens the PDF Panel to the correct page/coordinates.

---

## ðŸ  Phase 4: The "Resume" View (Dashboard)
*Replace the Dashboard with a utility-focused start page.*

- [ ] **Create Route:** `app/(main)/resume/page.tsx`.
- [ ] **Implement Greeting:** Minimal header ("Good afternoon, [Name]").
- [ ] **Implement "Continue" Section:** Query Dexie for last 3 modified projects.
- [ ] **Implement "Up Next":** Query Dexie/Calendar for tasks due within 24h.
- [ ] **Implement "Inbox":** Query for captured items not yet assigned to a project.
- [ ] **Cleanup:** Remove "Focus Scores" and syllabus parsers.

---

## ðŸ§  Phase 5: Re-integrating Intelligence & Views
*Restore power features as optional modes.*

### 5.1 View Modes
- [ ] **Refactor Infinite Canvas:** Convert `InfiniteCanvas.tsx` to a "View Mode" for the Block Editor (Blocks -> Cards).
- [ ] **Add View Toggle:** Header control to switch between `List` and `Canvas`.

### 5.2 Study Tools
- [ ] **Create Study Overlay:** Full-screen focus mode implementing the Flashcard logic.
- [ ] **Refactor AI:**
  - [ ] Remove `AICommandCenter`.
  - [ ] Move AI to background workers (`miner.worker.ts`).
  - [ ] Trigger AI only via Slash Command (e.g., `/summarize`, `/critique`).
- [ ]
## â˜ï¸ Phase 6: "Infinite Memory" (Google Drive Sync)
*Strategy: Complete State Mirroring. Users own the storage, so we sync everything by default.*

### 6.1 Authentication & Permissions
- [ ] **Google OAuth 2.0 Integration:**
  - [ ] **Scope:** `drive.file` or `drive.appdata`. (Grants access only to files created by Jivvy).
  - [ ] **User Flow:** "Sign in with Google" -> "Select Sync Folder".
  - [ ] **Cost Model:** 100% User-side. Zero server costs for Jivvy.

### 6.2 The "Full State" Sync Engine
- [ ] **Data Serialization (The "Zip" Approach):**
  - [ ] **Core Data:** Blocks, Pages, Projects (JSON).
  - [ ] **Heavy Assets:** Vectors, Embeddings, Cached PDF Blobs.
  - [ ] **Mechanism:** Bundle user state into a `jivvy_backup.json` (or distinct files per project).
- [ ] **Sync Settings (User Control):**
  - [ ] **Default:** Sync All.
  - [ ] **Toggle:** "Sync Large Assets" (On/Off).
    -   *If Off:* Sync text only; regenerate vectors on the new device to save Drive space.
    -   *If On:* Instant "Resume" on any device without re-processing.

### 6.3 Smart Upload Strategies (Battery Safe)
*Even though storage is free, radio usage kills battery. We manage the upload timing.*
- [ ] **Tiered Syncing:**
  - [ ] **Tier 1 (Instant):** Text & Checkbox edits sync immediately (bytes).
  - [ ] **Tier 2 (Deferred):** Heavy Vectors/PDFs sync when:
    -   Device is on **Wi-Fi**.
    -   Device is **Plugged In** (or Battery > 50%).
- [ ] **Conflict Handling:**
  -   Use "Last Modified" timestamps on the Drive file to detect changes from other devices.
  -   Simple prompt on conflict: "Cloud is newer. Overwrite local?"
    
## ðŸ“… Phase 7: Deep Work Tools (Views & Intelligence)
*Going beyond the list: Visualizing time and forcing actual learning.*

### 7.1 The Project Calendar View
*Goal: Compete with Notionâ€™s calendar by allowing any Project to be viewed as a Timeline.*
- [ ] **Create `CalendarView.tsx`:**
  - [ ] **Integration:** Add as a toggle option in the Project Header (List | Canvas | **Calendar**).
  - [ ] **Data Source:** Filters the current projectâ€™s Blocks for any that have a `due_date` property.
- [ ] **Interactions (Mouse-First):**
  - [ ] **Drag to Reschedule:** Dragging a task card from one day to another updates the `due_date` in Dexie.
  - [ ] **Quick View:** Clicking a calendar item opens the standard "Edit Block" modal (or Context Panel) without navigating away.
- [ ] **Visual Style:**
  - [ ] Keep the "Calm" aesthetic: Minimal grid lines, simple dots for low-priority tasks, colored bars for high-priority.

### 7.2 The "Cognitive Load" MCQ Engine
*Goal: Prevent guessing. The AI must generate "plausible lies" (Semantic Distractors).*
- [ ] **Refactor `miner.worker.ts`:**
  - [ ] **Input:** A specific Fact Block (e.g., "Mitochondria = Powerhouse").
  - [ ] **Prompt Engineering:**
    -   *Wrong:* "Generate 3 random wrong answers."
    -   *Correct:* "Generate 3 answers that are **semantically related** to the topic but **factually incorrect** relative to the definition."
- [ ] **Distractor Logic:**
  -   If the answer is a date (1995), generate close dates (1993, 1999).
  -   If the answer is a scientific term (Proton), generate related terms (Neutron, Electron).
- [ ] **Validation:** Ensure the correct answer is never generated as a distractor.
    
## ðŸ“‚ Target Directory Structure

```text
/app
  /(main)            # Authenticated Routes
    /resume          # Was Dashboard
    /inbox           # Quick Capture
    /calendar
    /project/[id]    # The Main Workspace
  /login
/components
  /editor            # The Block Engine
    Block.tsx
    SlashMenu.tsx
    CanvasView.tsx
  /pdf               # PDF Tools
    PDFContextPanel.tsx
    PDFViewer.tsx
  /layout
    AppShell.tsx
    Sidebar.tsx
  /ui                # Shadcn/Clean Components
/lib
  store.ts           # Zustand (UI State)
  db.ts              # Dexie (Local DB)
  ai.ts              # AI Service Clients
/workers
  miner.worker.ts    # Background AI
